---
import SiteLayout from '../layouts/site.astro';
import { Image } from '@astrojs/image/components';
import { getImage } from '@astrojs/image';
import { getCollection } from "astro:content";
import FormattedDate from "../components/FormattedDate.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";

const p = (await getCollection("blog")).sort(
	(a, b) => a.data.date.valueOf() - b.data.date.valueOf()
);
const posts = await Promise.all(p.map(async(post) => {
	post.data.image = await getImage({
		src: import(`../content/blog/${post.slug}/main.jpg`),
		alt: post.data.title,
	})
	return post
}))
---

<SiteLayout title="">
	<style lang="scss">
		@import '../styles/global.scss';
		div.blog-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
			transition: all ease 0.5s;

			a {
				display: flex;
				position: relative;

				img {
					object-fit: cover;
					object-position: center;
					min-height: 100.2%;
					min-width: 100.2%;
					max-height: 100.8%;
					max-width: 100.8%;
				}	

				p {
					@include font-montserrat;
					
					position: absolute;
					margin: 0;
					width: 100%;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%) scale(0.8);
					text-align: center;

					color: $light-grey;
					font-size: 1.2rem;
					opacity: 0;

					transition: all 0.6s ease;
					z-index: 6;
				}
				
				&:after {
						content: "";
						display: block;
						position: absolute;
						object-fit: cover;
						object-position: center;
						width: 100.3%;
						height: 100.3%;
						top: 0;
						opacity: 0;
						background: rgba(0, 0, 0, 0.55);
						transition: opacity 0.6s ease;
					}
				&:hover {
					&:after {
						opacity: 1;
					}
					p {
						opacity: 1;
						transform: translate(-50%, -50%) scale(1);
					}
				}
			}
		}
	</style>

		<div class="blog-grid">
				{
					posts.map((post) => (
						
						<div class="grid-item">
							<a href={`/blog/${post.slug}/`}>
								<img  src={post.data.image.src} alt={post.data.title}>
									<p>
										{post.data.title}
										<br />
										<FormattedDate
											date={post.data.date}
										/>
									</p>
								</img>
							</a>
						</div>
					))
				}
			</div>
		</SiteLayout>